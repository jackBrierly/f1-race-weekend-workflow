Problem Statement:

F1 teams make hundreds of decisions during a race weekend, particularly around car setup changes during Practice and Qualifying. These decisions involve multiple engineers, strict time constraints, and session-based rules that restrict what can be changed once a session begins or a setup becomes locked. In practice, information is often spread across messages, spreadsheets, and verbal communication, making it difficult to clearly track what changed, who approved it, and why.

This lack of a single, reliable source of truth can lead to confusion about the current car setup, duplicate or conflicting changes, unclear responsibility for approvals, difficulty reviewing decisions after a session, and mistakes caused by time pressure or miscommunication.

The goal of this project is to design and build a workflow and decision-tracking system that provides clarity and structure during a race weekend. The system should show the current stage of the weekend, maintain versioned car setups, allow engineers to propose changes, require approvals from authorised roles, enforce session-based rules, and maintain an audit trail of all decisions. By doing so, the system aims to reduce operational errors and give teams a clear, shared understanding of decisions made under pressure.


Roles:

Engineer
- Proposes car setup changes based on driver feedback and session observations.
- Creates change requests with a clear description and reason.
- Adds notes and feedback during sessions.
- Cannot approve changes or bypass locked states.

Lead Engineer
- Reviews and approves or rejects proposed setup changes.
- Authorised to create new setup versions by approving change requests.
- Responsible for decisions made during time-critical sessions.
- Can transition the race weekend workflow between stages (e.g. Practice to Qualifying), which controls what actions are allowed at that time.

Viewer
- Has read-only access to the system.
- Can view current setups, decision history, and audit logs.
- Cannot create, modify, or approve any changes.


Workflow Stages:

Practice
- Focused on experimentation and data gathering.
- Setup changes can be created and iterated without a formal approval step enforced by the system.
- Decisions are collaborative and overseen by senior engineers, though this oversight is not explicitly modelled.
- Notes and feedback are recorded for later review.
Permissions:
- Engineers: create setup versions, record notes.
- Lead Engineers: create setup versions, record notes.
- Approvals: not enforced by the system.

Qualifying
- Focused on performance with stricter controls.
- Engineers can no longer directly edit the current car setup.
- Engineers may propose setup changes for review.
- A Lead Engineer must approve or reject each proposed change.
- Approved changes create a new setup version to preserve traceability.
Permissions:
- Engineers: propose changes, record notes.
- Lead Engineers: approve or reject changes.
- Direct setup edits: not allowed.

Race
- Focused on stability, reliability, and execution.
- Core setup parameters cannot be structurally changed.
- Limited operational adjustments may occur but are not versioned.
- Strategy notes and observations are recorded.
Permissions:
- Engineers: record notes only.
- Lead Engineers: record notes only.
- Setup changes: not allowed.

Review
- Post-session analysis and reflection.
- Teams review setup versions, decisions, and outcomes.
- No changes to setups are permitted.
Permissions:
- Engineers: read-only access.
- Lead Engineers: read-only access.
- Modifications: not allowed.


Data Models:

Team
- Purpose: Represents an organisation (e.g. a racing team) that owns weekends, setups, and decisions.
- Fields:
  - id: unique identifier
  - name: e.g. "McLaren"
  - createdAt: timestamp

Weekend
- Purpose: Represents a single race weekend and the current workflow state.
- Fields:
  - id: unique identifier
  - name: e.g. "Silverstone GP"
  - teamId: link to Team
  - stage: one of Practice, Qualifying, Race, Review
  - segment: optional sub-stage (e.g. Q1, Q2, Q3)
  - createdAt: timestamp
  - updatedAt: timestamp

SetupVersion
- Purpose: A saved snapshot of the car setup that the team can reference (“what the setup was at this moment”).
- Key idea: SetupVersions are facts, not proposals.
- Fields:
  - id: unique identifier
  - changeRequestId: optional link to ChangeRequest (set only when created via approval)
  - weekendId: link to Weekend
  - teamId: link to Team
  - versionNumber: integer (e.g. 5)
  - session: Practice | Qualifying | Race
  - state: Mutable | Finalised | Locked
    - Mutable: setup values may be changed directly (Practice only)
    - Finalised: setup values cannot be changed; new versions require approval (Qualifying)
    - Locked: setup values cannot be changed and no new versions may be created (Race)
  - parameters: key-value map of setup values (kept small in MVP)
  - createdByName: user-entered name
  - createdByRole: Engineer | Lead Engineer
  - createdAt: timestamp

ChangeRequest
- Purpose: A proposed change to the setup that is waiting for a decision.
- Key idea: ChangeRequests are proposals; if approved, they create a NEW SetupVersion.
- Fields:
  - id: unique identifier
  - weekendId: link to Weekend
  - teamId: link to Team
  - baseSetupId: the setup version the proposal is based on
  - status: Pending | Approved | Rejected
  - changes: list of { field, fromValue, toValue }
  - reason: free text (required)
  - appliesTo: optional label (e.g. "Q2 Run 2")
  - createdByName: user-entered name
  - createdAt: timestamp
  - decidedByName: Lead Engineer name (if decided)
  - decidedAt: timestamp (if decided)
  - decisionNote: optional context (especially for rejection)

Note
- Purpose: Captures driver feedback or engineer observations tied to a stage/session.
- Fields:
  - id: unique identifier
  - weekendId: link to Weekend
  - teamId: link to Team (denormalised for easy filtering)
  - type: DriverFeedback or EngineerNote
  - session: Practice, Qualifying, or Race
  - segment: optional (e.g. Q1/Q2/Q3)
  - text: free text (required)
  - createdByName: user-entered name
  - createdByRole: Engineer or Lead Engineer
  - createdAt: timestamp

AuditEvent
- Purpose: An immutable event log for traceability ("who did what and why").
- Fields:
  - id: unique identifier
  - weekendId: link to Weekend
  - teamId: link to Team (denormalised for easy filtering)
  - action: e.g. StageChanged, ChangeProposed, ChangeApproved, ChangeRejected, SetupLocked
  - entityType: Weekend, SetupVersion, ChangeRequest, Note
  - entityId: id of the entity affected
  - actorName: user-entered name
  - actorRole: Engineer, Lead Engineer, or Viewer
  - timestamp: timestamp
  - details: JSON metadata (e.g. previousStage, newStage, versionNumber, reason)


API Endpoints (REST):

Conventions
- Content-Type: application/json
- All request and response bodies are JSON.
- Each request includes actorName and actorRole (prototype approach) which are validated server-side.
- teamId is provided in the URL to scope all reads and writes to a single team.
- The API enforces workflow rules (stage restrictions, permissions) and returns appropriate HTTP status codes.
- Error response shape: { "error": "CODE", "message": "Human readable message" }

Teams
- GET /teams
  - List all teams.
- POST /teams
  - Create a new team.
  - Body: { "name": "McLaren" }

Weekend / Workflow
- GET /teams/{teamId}/weekends
  - List all weekends for a team.
- POST /teams/{teamId}/weekends
  - Create a new weekend for a team.
  - Body: { "name": "Silverstone GP" }
- GET /teams/{teamId}/weekends/{weekendId}
  - Get weekend summary including current stage/segment.
- POST /teams/{teamId}/weekends/{weekendId}/transition
  - Transition the weekend workflow stage/segment (Lead Engineer only).
  - Body: { "toStage": "Qualifying", "toSegment": "Q2" }

Setup Versions
- GET /teams/{teamId}/weekends/{weekendId}/setups
  - List setup versions for the weekend.
  - Query params: session=Practice|Qualifying|Race, latest=true|false
- GET /setups/{setupId}
  - Get a single setup version.
- POST /teams/{teamId}/weekends/{weekendId}/setups
  - Create a setup version (Practice only; in Qualifying/Race versions are created via approval).
  - Body: { "session": "Practice", "parameters": { ... }, "status": "Draft" }

Change Requests (Propose / Approve)
- GET /teams/{teamId}/weekends/{weekendId}/change-requests
  - List change requests for the weekend.
  - Query params: status=Pending|Approved|Rejected, session=Practice|Qualifying|Race (optional)
- POST /teams/{teamId}/weekends/{weekendId}/change-requests
  - Propose a setup change (Engineer only; primarily used in Qualifying).
  - Body: { "fromSetupId": "...", "changes": [ { "field": "...", "fromValue": 0, "toValue": 1 } ], "reason": "...", "appliesTo": "Q2 Run 2" }
- POST /change-requests/{changeRequestId}/approve
  - Approve a proposed change (Lead Engineer only) and create a new SetupVersion.
  - Body: { "decisionNote": "optional" }
- POST /change-requests/{changeRequestId}/reject
  - Reject a proposed change (Lead Engineer only).
  - Body: { "decisionNote": "reason for rejection" }

Notes
- GET /teams/{teamId}/weekends/{weekendId}/notes
  - List notes for the weekend.
  - Query params: session=Practice|Qualifying|Race, segment=Q1|Q2|Q3 (optional)
- POST /teams/{teamId}/weekends/{weekendId}/notes
  - Create a note (Engineer or Lead Engineer).
  - Body: { "type": "DriverFeedback", "session": "Qualifying", "segment": "Q2", "text": "..." }

Audit Log
- GET /teams/{teamId}/weekends/{weekendId}/audit
  - List audit events for the weekend.
  - Query params: limit=number (optional)


API Contract

Common Error Codes
- 400 Bad Request: missing/invalid fields in request body
- 403 Forbidden: role not allowed to perform action
- 404 Not Found: team/weekend/entity not found
- 409 Conflict: workflow rule violated (wrong stage, locked, invalid transition)
- 500 Internal Server Error: unexpected server error


TEAMS

POST /teams
Purpose:
- Create a new team.
Role rule:
- Allowed roles: any (or omit role checks for MVP).
Request:
- Body: { "name": "McLaren" }
Success Response:
- 201 Created
- Body: { "id": "t1", "name": "McLaren", "createdAt": "..." }
Errors:
- 400: name missing/empty

GET /teams
Purpose:
- List all teams.
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: { "teams": [ { "id": "t1", "name": "McLaren", "createdAt": "..." } ] }


WEEKEND / WORKFLOW

POST /teams/{teamId}/weekends
Purpose:
- Create a new race weekend for a team.
Role rule:
- Allowed roles: Engineer, LeadEngineer.
Request:
- Body: { "name": "Silverstone GP" }
Success Response:
- 201 Created
- Body: {
    "id": "w1",
    "teamId": "t1",
    "name": "Silverstone GP",
    "stage": "Practice",
    "segment": null,
    "createdAt": "...",
    "updatedAt": "..."
  }
Errors:
- 400: name missing/empty
- 403: role not allowed
- 404: team not found

GET /teams/{teamId}/weekends
Purpose:
- List all weekends for a team.
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: { "weekends": [ { "id": "w1", "name": "Silverstone GP", "stage": "Practice", "segment": null, "createdAt": "...", "updatedAt": "..." } ] }
Errors:
- 404: team not found

GET /teams/{teamId}/weekends/{weekendId}
Purpose:
- Retrieve a weekend summary including current stage/segment.
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: {
    "id": "w1",
    "teamId": "t1",
    "name": "Silverstone GP",
    "stage": "Qualifying",
    "segment": "Q2",
    "createdAt": "...",
    "updatedAt": "..."
  }
Errors:
- 404: team or weekend not found (or mismatch)

POST /teams/{teamId}/weekends/{weekendId}/transition
Purpose:
- Transition the weekend workflow stage/segment (controls what actions are allowed).
Role rule:
- Allowed roles: LeadEngineer only.
Request:
- Body: { "toStage": "Qualifying", "toSegment": "Q2" }
Success Response:
- 200 OK
- Body: { "id": "w1", "stage": "Qualifying", "segment": "Q2", "updatedAt": "..." }
Errors:
- 403: not LeadEngineer
- 404: team/weekend not found
- 409: invalid transition (e.g. Race -> Practice)


SETUP VERSIONS

GET /teams/{teamId}/weekends/{weekendId}/setups?session=Practice&latest=false
Purpose:
- List setup versions for a weekend (optionally filter by session, optionally fetch only latest).
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: {
    "setups": [
      { "id": "s1", "versionNumber": 1, "session": "Practice", "state": "Mutable", "changeRequestId": null, "parameters": { ... }, "createdByName": "...", "createdAt": "..." }
    ]
  }
Errors:
- 404: team/weekend not found

GET /setups/{setupId}
Purpose:
- Get a single setup version.
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: {
    "id": "s1",
    "weekendId": "w1",
    "teamId": "t1",
    "versionNumber": 1,
    "session": "Practice",
    "state": "Mutable",
    "changeRequestId": null,
    "parameters": { ... },
    "createdByName": "...",
    "createdAt": "..."
  }
Errors:
- 404: setup not found

POST /teams/{teamId}/weekends/{weekendId}/setups
Purpose:
- Create a new setup version directly (Practice only).
Role rule:
- Allowed roles: Engineer, LeadEngineer.
Request:
- Body: { "session": "Practice", "parameters": { ... } }
Success Response:
- 201 Created
- Body: { "id": "s2", "versionNumber": 2, "session": "Practice", "state": "Mutable", "changeRequestId": null, "parameters": { ... }, "createdByName": "...", "createdAt": "..." }
Errors:
- 403: role not allowed
- 404: team/weekend not found
- 409: not allowed outside Practice


CHANGE REQUESTS (PROPOSE / APPROVE / REJECT)

GET /teams/{teamId}/weekends/{weekendId}/change-requests?status=Pending
Purpose:
- List change requests for a weekend (filter by status).
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: {
    "changeRequests": [
      { "id": "cr1", "status": "Pending", "baseSetupId": "s2", "changes": [ ... ], "reason": "...", "appliesTo": "...", "createdByName": "...", "createdAt": "..." }
    ]
  }
Errors:
- 404: team/weekend not found

POST /teams/{teamId}/weekends/{weekendId}/change-requests
Purpose:
- Propose a setup change for review (used mainly in Qualifying).
Role rule:
- Allowed roles: Engineer only.
Request:
- Body: {
    "baseSetupId": "s2",
    "changes": [ { "field": "frontWing", "fromValue": 5, "toValue": 7 } ],
    "reason": "More front end bite",
    "appliesTo": "Q2 Run 2"
  }
Success Response:
- 201 Created
- Body: { "id": "cr1", "status": "Pending", "baseSetupId": "s2", "changes": [ ... ], "reason": "...", "appliesTo": "...", "createdByName": "...", "createdAt": "..." }
Errors:
- 403: not Engineer
- 404: team/weekend/base setup not found
- 409: stage does not allow proposals

POST /change-requests/{changeRequestId}/approve
Purpose:
- Approve a proposed change and create a new setup version.
Role rule:
- Allowed roles: LeadEngineer only.
Request:
- Body: { "decisionNote": "optional" }
Success Response:
- 200 OK
- Body: {
    "changeRequest": { "id": "cr1", "status": "Approved", "decidedByName": "...", "decidedAt": "...", "decisionNote": "..." },
    "newSetupVersion": { "id": "s3", "versionNumber": 3, "session": "Qualifying", "state": "Finalised", "changeRequestId": "cr1", "parameters": { ... }, "createdAt": "..." }
  }
Errors:
- 403: not LeadEngineer
- 404: change request not found
- 409: already decided OR wrong stage OR base setup mismatch

POST /change-requests/{changeRequestId}/reject
Purpose:
- Reject a proposed change.
Role rule:
- Allowed roles: LeadEngineer only.
Request:
- Body: { "decisionNote": "reason for rejection" }
Success Response:
- 200 OK
- Body: { "id": "cr1", "status": "Rejected", "decidedByName": "...", "decidedAt": "...", "decisionNote": "..." }
Errors:
- 403: not LeadEngineer
- 404: change request not found
- 409: already decided OR wrong stage


NOTES

GET /teams/{teamId}/weekends/{weekendId}/notes?session=Qualifying&segment=Q2
Purpose:
- List notes for a weekend (optionally filter by session/segment).
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: {
    "notes": [
      { "id": "n1", "type": "DriverFeedback", "session": "Qualifying", "segment": "Q2", "text": "...", "createdByName": "...", "createdAt": "..." }
    ]
  }
Errors:
- 404: team/weekend not found

POST /teams/{teamId}/weekends/{weekendId}/notes
Purpose:
- Create a note (driver feedback or engineer observation).
Role rule:
- Allowed roles: Engineer, LeadEngineer.
Request:
- Body: { "type": "DriverFeedback", "session": "Qualifying", "segment": "Q2", "text": "Rear feels loose on entry" }
Success Response:
- 201 Created
- Body: { "id": "n1", "type": "DriverFeedback", "session": "Qualifying", "segment": "Q2", "text": "...", "createdByName": "...", "createdAt": "..." }
Errors:
- 400: text missing/empty
- 403: Viewer not allowed
- 404: team/weekend not found


AUDIT LOG

GET /teams/{teamId}/weekends/{weekendId}/audit?limit=50
Purpose:
- List audit events for traceability (“who did what and why”).
Role rule:
- Allowed roles: Engineer, LeadEngineer, Viewer.
Success Response:
- 200 OK
- Body: {
    "events": [
      { "id": "a1", "action": "ChangeProposed", "entityType": "ChangeRequest", "entityId": "cr1", "actorName": "...", "actorRole": "Engineer", "timestamp": "...", "details": { ... } }
    ]
  }
Errors:
- 404: team/weekend not found


Definition of Done (Sprint 0)

The planning phase (Sprint 0) is considered complete when:

/ The problem being solved is clearly articulated and scoped.
/ User roles and responsibilities are defined and understood.
/ Workflow stages and their rules are explicitly documented.
/ Core data models are defined with clear purposes and fields.
/ REST API endpoints are specified and aligned with the workflow.
/ Key design decisions (e.g. no generic DELETE/UPDATE, role-based access) are documented and justified.
/ API contract is documented with request/response shapes and error codes.
/ Workflow diagram is created to visualise stage transitions and approval flow.

At this point, the system design is stable enough to begin implementation, with no ambiguity around scope, behaviour, or responsibilities.


Sprint 1 Goal:
Implement the core backend skeleton that enforces the workflow rules and exposes the core API endpoints.

Definition of Done (Sprint 1)

Sprint 1 is considered complete when:

- The backend server starts successfully and runs locally.
- A health endpoint responds with 200 OK.
- Teams can be created and listed via the API.
- Code is organised into routes, controllers, and models.
- Core API behaviour matches the documented contract.
- Invalid requests return appropriate HTTP error codes.
- All work is committed with clear, incremental commit messages.

At this point, the core backend foundation is in place, the workflow rules are enforced server-side, and the system is stable enough to begin adding additional features and persistence without ambiguity around behaviour or responsibilities.
